<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Comensal - Sabor Gourmet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-3">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>Reservas vigentes / Histórico</h2>
      <a class="btn btn-outline-secondary" th:href="@{/logout}">Salir</a>
    </div>

    <h5>Reservas actuales</h5>
    <table class="table table-sm"><thead>
      <tr><th>#</th><th>Cliente</th><th>Mesa</th><th>Inicio</th><th>Fin</th><th>Estado</th></tr>
    </thead><tbody id="tbActuales"></tbody></table>

    <h5>Histórico</h5>
    <table class="table table-sm"><thead>
      <tr><th>Fecha</th><th>Acción</th><th>Usuario</th><th>Reserva</th><th>Detalle</th></tr>
    </thead><tbody id="tbHist"></tbody></table>
  </div>

  <script>
    const api = {
      actuales: () => fetch('/api/reservas').then(r=>r.json()),
      historial: () => fetch('/api/historico').then(r=>r.json())
    };
    async function load() {
      const a = await api.actuales(), h = await api.historial();
      const tbA = document.getElementById('tbActuales'); tbA.innerHTML='';
      a.forEach(r => tbA.insertAdjacentHTML('beforeend',
        `<tr><td>${r.id}</td><td>${r.username}</td><td>${r.mesaNumero}</td><td>${r.inicio}</td><td>${r.fin}</td><td>${r.estado}</td></tr>`));
      const tbH = document.getElementById('tbHist'); tbH.innerHTML='';
      h.forEach(x => tbH.insertAdjacentHTML('beforeend',
        `<tr><td>${x.fechaHora}</td><td>${x.accion}</td><td>${x.actor}</td><td>${x.reservaId}</td><td>${x.detalle||''}</td></tr>`));
    }
    load();
  </script>
</body>
</html>
